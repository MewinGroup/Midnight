---
export const prerender = false;
const data = Astro.locals as { token?: { value: string } };
import Layout from "@Layouts/layout.astro";
import Sidebar from "@components/Sidebar.astro";
import Card from "@components/menu/Card.astro";
import { verify, userinfo } from "@Lib/auth";

if ((await verify(data.token?.value)) == false) {
  return new Response(null, {
    status: 302,
    headers: {
      Location: "/",
    },
  });
}
const token = data.token?.value;
const res = await userinfo(token);
const user = res;
if (user.tipo_perfil==3) {
  return new Response(null, {
    status: 302,
    headers: {
      Location: "/",
    },
  });
}
---

<Layout title="Panel de Control">
  <div
    class="flex flex-col md:flex-row bg-gray-100 h-screen dark:bg-gray-800 dark:text-white"
  >
    <!-- Sidebar -->
    <Sidebar tipo={user.tipo_perfil}>
      <div class="flex-1 p-4 md:p-6 dark:bg-gray-800">
        <h1 class="text-3xl font-bold mb-6">Resumen</h1>

        <div class="flex items-center justify-end mb-6">
          <div class="flex items-center space-x-2">
            <div
              class="w-12 h-12 rounded-full overflow-hidden border-2 border-gray-300 dark:border-gray-500"
            >
              <img
                src={user.imagen ||
                  "https://avatars.githubusercontent.com/u/178928214?v=4"}
                alt="Foto de perfil"
                class="w-full h-full object-cover"
              />
            </div>
            <div class="text-right">
              <h1 class="text-xl font-bold">Hola, {user.nombre}</h1>
              <p class="text-gray-600 dark:text-gray-400 text-sm">
                {
                  user.tipo_perfil == 1
                    ? "Administrador"
                    : user.tipo_perfil == 2
                      ? "Vendedor"
                      : "Usuario"
                }
              </p>
            </div>
          </div>
        </div>
        <!-- Contenido de tarjetas -->
        <div class="grid grid-cols-1 gap-6 md:grid-cols-3">
          <Card title="Ventas Totales" description="El ultimo Mes">${0}</Card>
          <Card title="Ventas Recientes" description="Ultimas 24 Horas"
            >${0}</Card
          >
          <Card title="Ventas Semanales" description="Ultima Semana">${0}</Card>
        </div>

        <!-- Tabla de Ã³rdenes recientes -->
        <div
          class="mt-6 bg-white p-6 rounded-lg shadow-md overflow-x-auto dark:bg-gray-700"
        >
          <h2 class="text-xl font-semibold">Pedidos Recientes</h2>
          <table class="min-w-full mt-4 table-auto dark:border-gray-700">
            <thead class="dark:border-gray-700">
              <tr>
                <th class="px-4 py-2">Nombre del producto</th>
                <th class="px-4 py-2">Numero de producto</th>
                <th class="px-4 py-2">Metodo de pago</th>
                <th class="px-4 py-2">Estado</th>
              </tr>
            </thead>
            <tbody> </tbody>
          </table>
        </div>

        <!-- Actualizaciones recientes -->
        <div
          class="mt-6 bg-white p-6 rounded-lg shadow-md dark:bg-gray-700 dark:text-white"
        >
          <h2 class="text-xl font-semibold dark:text-white">
            Ventas Realizadas Recientemente
          </h2>
          <ul class="mt-4 space-y-4"></ul>
        </div>
      </div>
    </Sidebar>

    <!-- Main Content -->
  </div>

</Layout>
